# 長期儲存空間分析報告

## 📊 使用量假設

### 每日資料量
- **每日匯入**: 30-50 筆資料
- **每月工作天數**: 22 天（假設）
- **每月資料量**: 30 × 22 = 660 筆 ~ 50 × 22 = 1,100 筆
- **每年資料量**: 660 × 12 = 7,920 筆 ~ 1,100 × 12 = 13,200 筆

---

## 💾 資料庫大小分析

### 單筆資料大小估算

根據 `schedule_items` 表的結構：

```typescript
{
  id: string,                    // UUID: ~36 bytes
  product_name: string,          // ~50 bytes
  batch_number: string,          // ~20 bytes
  quantity: number,              // 8 bytes
  line_id: string,              // ~10 bytes
  schedule_date: string,         // ~10 bytes (YYYY-MM-DD)
  start_hour: number,           // 8 bytes
  end_hour: number,             // 8 bytes
  material_ready_date: string,  // ~10 bytes
  recipe_items: jsonb,          // ~500-2000 bytes (可變，包含配方資料)
  created_at: timestamp,        // 8 bytes
  updated_at: timestamp,        // 8 bytes
  // 其他欄位...
}
```

**單筆資料大小估算**:
- **最小**: ~700 bytes（無配方資料）
- **平均**: ~1,500 bytes（有配方資料）
- **最大**: ~3,000 bytes（大量配方資料）

### 長期累積計算

#### 場景 1：每日 30 筆（保守估計）

| 時間 | 累積筆數 | 資料庫大小（最小） | 資料庫大小（平均） | 資料庫大小（最大） |
|------|----------|-------------------|-------------------|-------------------|
| 1 個月 | 660 筆 | 0.46 MB | 0.99 MB | 1.98 MB |
| 3 個月 | 1,980 筆 | 1.39 MB | 2.97 MB | 5.94 MB |
| 6 個月 | 3,960 筆 | 2.77 MB | 5.94 MB | 11.88 MB |
| 1 年 | 7,920 筆 | 5.54 MB | 11.88 MB | 23.76 MB |
| 2 年 | 15,840 筆 | 11.09 MB | 23.76 MB | 47.52 MB |
| 5 年 | 39,600 筆 | 27.72 MB | 59.40 MB | 118.80 MB |

#### 場景 2：每日 50 筆（較高估計）

| 時間 | 累積筆數 | 資料庫大小（最小） | 資料庫大小（平均） | 資料庫大小（最大） |
|------|----------|-------------------|-------------------|-------------------|
| 1 個月 | 1,100 筆 | 0.77 MB | 1.65 MB | 3.30 MB |
| 3 個月 | 3,300 筆 | 2.31 MB | 4.95 MB | 9.90 MB |
| 6 個月 | 6,600 筆 | 4.62 MB | 9.90 MB | 19.80 MB |
| 1 年 | 13,200 筆 | 9.24 MB | 19.80 MB | 39.60 MB |
| 2 年 | 26,400 筆 | 18.48 MB | 39.60 MB | 79.20 MB |
| 5 年 | 66,000 筆 | 46.20 MB | 99.00 MB | 198.00 MB |

---

## 📈 Supabase 免費層限制

### 資料庫大小限制
- **免費層**: 500 MB
- **Pro 方案**: 8 GB ($25/月)
- **Team 方案**: 100 GB ($599/月)

### 分析結果

#### 免費層（500 MB）
- ✅ **1-2 年內**: 完全足夠（即使每日 50 筆，2 年約 79 MB）
- ⚠️ **3-5 年**: 可能需要清理舊資料
- ❌ **5 年以上**: 可能需要升級或清理策略

#### Pro 方案（8 GB）
- ✅ **長期使用**: 完全足夠（即使每日 50 筆，5 年約 198 MB）
- ✅ **10 年以上**: 仍然足夠（約 396 MB）

---

## 🔄 Egress 使用量分析（數據傳輸）

### 每次操作估算

#### 載入資料
- **單次查詢**: 100 筆 × 1.5 KB = 150 KB
- **每日載入次數**: 10-20 次（多用戶使用）
- **每日載入量**: 150 KB × 15 = 2.25 MB

#### 儲存資料
- **單次儲存**: 100 筆 × 1.5 KB = 150 KB
- **每日儲存次數**: 5-10 次
- **每日儲存量**: 150 KB × 7 = 1.05 MB

#### Realtime 同步
- **單次同步**: 100 筆 × 1.5 KB = 150 KB
- **每日同步次數**: 20-30 次（多用戶、多分頁）
- **每日同步量**: 150 KB × 25 = 3.75 MB

### 每月 Egress 使用量

**總計**: (2.25 + 1.05 + 3.75) × 22 工作天 = **154.65 MB/月**

**加上優化前的額外開銷**（已優化）:
- 優化前: 可能達到 500-1000 MB/月
- 優化後: 約 150-200 MB/月

### 長期 Egress 使用量

| 時間 | 累積 Egress（優化後） |
|------|---------------------|
| 1 個月 | 155 MB |
| 3 個月 | 465 MB |
| 6 個月 | 930 MB |
| 1 年 | 1.86 GB |
| 2 年 | 3.72 GB |

**Supabase 免費層限制**: 5 GB/月

**分析結果**:
- ✅ **優化後**: 每月約 155-200 MB，遠低於 5 GB 限制
- ✅ **長期使用**: 不會超過免費層限制

---

## 🎯 結論與建議

### 資料庫大小

#### 免費層（500 MB）
- ✅ **1-2 年**: 完全足夠
- ⚠️ **3-5 年**: 建議實施清理策略
- ❌ **5 年以上**: 需要升級或清理策略

#### Pro 方案（8 GB）
- ✅ **長期使用**: 完全足夠（10 年以上）

### Egress 使用量

#### 優化後
- ✅ **每月約 155-200 MB**，遠低於 5 GB 限制
- ✅ **長期使用**: 不會超過免費層限制

---

## 🔧 建議策略

### 策略 1：資料清理（免費）

#### 清理舊資料
- **保留期間**: 6-12 個月
- **清理頻率**: 每月或每季
- **清理方式**: 刪除已完成且超過保留期間的排程項目

#### 實施方式
1. 添加「清理舊資料」功能
2. 自動清理已完成且超過 6 個月的排程項目
3. 或手動清理不需要的歷史資料

**優點**:
- ✅ 免費
- ✅ 保持資料庫大小在合理範圍
- ✅ 提升查詢效能

**缺點**:
- ❌ 會刪除歷史資料
- ❌ 需要定期執行

---

### 策略 2：資料歸檔（免費）

#### 歸檔舊資料
- **歸檔期間**: 超過 6 個月的資料
- **歸檔方式**: 匯出到 CSV/Excel，然後從資料庫刪除
- **歸檔頻率**: 每季或每半年

**優點**:
- ✅ 免費
- ✅ 保留歷史資料（在本地檔案）
- ✅ 減少資料庫大小

**缺點**:
- ❌ 需要手動管理歸檔檔案
- ❌ 無法在系統中查詢歸檔資料

---

### 策略 3：升級 Supabase（付費）

#### Pro 方案 ($25/月)
- **資料庫大小**: 8 GB（比免費層多 16 倍）
- **Egress**: 50 GB/月（比免費層多 10 倍）
- **長期使用**: 完全足夠

**優點**:
- ✅ 不需要清理資料
- ✅ 保留所有歷史資料
- ✅ 更高的使用量限制

**缺點**:
- ❌ 需要付費 $25/月
- ❌ 長期成本累積

---

## 📋 推薦方案

### 短期（1-2 年）

**建議**: 繼續使用免費層
- ✅ 資料庫大小足夠（約 20-40 MB）
- ✅ Egress 使用量足夠（優化後約 155-200 MB/月）
- ✅ 不需要額外成本

### 中期（3-5 年）

**建議**: 實施資料清理策略
- ✅ 保留最近 6-12 個月的資料
- ✅ 定期清理舊資料
- ✅ 保持資料庫大小在 100-200 MB 以內

### 長期（5 年以上）

**建議**: 考慮升級或持續清理
- **選項 1**: 繼續清理策略（免費）
- **選項 2**: 升級到 Pro 方案（$25/月）

---

## 🎯 最終建議

### 如果每日 30-50 筆資料

1. **資料庫大小**: 
   - 免費層可以使用 **2-3 年**，之後需要清理或升級
   - Pro 方案可以使用 **10 年以上**

2. **Egress 使用量**:
   - 優化後每月約 **155-200 MB**，遠低於 5 GB 限制
   - **長期使用不會超過免費層限制**

3. **推薦策略**:
   - **短期（1-2 年）**: 繼續使用免費層
   - **中期（3-5 年）**: 實施資料清理策略
   - **長期（5 年以上）**: 考慮升級或持續清理

### 結論

✅ **短期內不需要擔心空間問題**
✅ **優化後，Egress 使用量不會超過免費層限制**
⚠️ **長期使用（3-5 年以上）需要考慮清理策略或升級**
